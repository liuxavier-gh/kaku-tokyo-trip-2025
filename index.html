<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>烏拉呀哈東京迷路大作戰 | 2025</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Noto+Serif+JP:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-text: #1a1a1a;
            --secondary-text: #666666;
            --accent-gold: #C5A065; 
            --btn-map: #428045;
            --btn-edit: #2980B9;
            --btn-black: #111111;
            --bg-color: #F8F8F8;
            --card-bg: #FFFFFF;
            --shadow: 0 8px 24px rgba(0,0,0,0.06);
            --radius: 20px;
            --food-color: #D35400;
            --tag-eat: #E67E22;
            --tag-buy: #9B59B6;
            --tag-spot: #2ECC71;
            --tag-todo: #E74C3C;
            --tag-other: #95A5A6;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0;
            padding: 0;
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg-color);
            color: var(--primary-text);
            padding-bottom: 90px;
            overflow-x: hidden;
        }

        h1, h2, h3, h4, .serif-font {
            font-family: 'Noto Serif JP', serif;
        }

        /* --- HEADER & DATE NAV --- */
        header {
            background: var(--bg-color);
            padding: 20px 20px 0 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .trip-title {
            text-align: center;
            font-size: 0.9rem;
            letter-spacing: 0.1em;
            color: var(--secondary-text);
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .date-scroller {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding: 15px 0;
            scrollbar-width: none;
        }
        .date-scroller::-webkit-scrollbar { display: none; }

        .date-item {
            min-width: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 0.4;
            transition: 0.3s;
            cursor: pointer;
            padding: 5px;
            border-radius: 8px;
        }
        
        .date-item:active { background-color: rgba(0,0,0,0.05); }
        .date-item.active { opacity: 1; transform: scale(1.05); color: var(--primary-text); }
        .date-item.active .day-num { border-bottom: 3px solid var(--accent-gold); color: var(--accent-gold); padding-bottom: 2px; }
        .date-item .day-name { font-size: 0.7rem; font-weight: bold; margin-bottom: 4px; }
        .date-item .day-num { font-size: 1.3rem; font-family: 'Noto Serif JP', serif; font-weight: bold; }

        /* --- CONTAINER & TABS --- */
        .container { padding: 0 20px; max-width: 600px; margin: 0 auto; }
        .tab-content { display: none; animation: fadeIn 0.4s; }
        .tab-content.active { display: block; }
        
        .day-view { display: none; animation: fadeIn 0.4s; }
        .day-view.active { display: block; }

        /* --- WEATHER WIDGET --- */
        .weather-scroll-container { margin: 20px 0; }
        .weather-title { font-size: 0.8rem; color: var(--secondary-text); margin-bottom: 10px; }
        .weather-scroll { display: flex; gap: 20px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; }
        .weather-scroll::-webkit-scrollbar { display: none; }
        .weather-hour { display: flex; flex-direction: column; align-items: center; min-width: 50px; font-size: 0.85rem; }
        .weather-hour i { font-size: 1.2rem; margin: 8px 0; color: #F39C12; }

        /* --- MEAL CARD --- */
        .meal-card {
            background: #fff;
            padding: 12px 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 0.95rem;
            color: #444;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            display: flex;
            align-items: center;
            border-left: 4px solid #D35400;
        }
        .meal-card i { color: #D35400; margin-right: 8px; font-size: 1rem; }
        .meal-card strong { margin-right: 5px; color: #1a1a1a; }

        /* --- TIMELINE CARD --- */
        .timeline-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            overflow: hidden;
            position: relative;
            z-index: 2;
        }

        .card-image { width: 100%; height: 220px; object-fit: cover; display: block; }
        .card-content { padding: 24px; }

        .card-meta { display: flex; align-items: center; font-size: 0.75rem; color: var(--accent-gold); letter-spacing: 0.05em; margin-bottom: 8px; font-weight: 700; text-transform: uppercase; }
        .card-meta i { margin-right: 6px; }
        .card-meta.food { color: var(--food-color); }

        .card-title { font-size: 1.3rem; margin: 0 0 5px 0; line-height: 1.3; display: flex; align-items: center; cursor: pointer; transition: color 0.2s; }
        .card-title:active { color: var(--accent-gold); }
        .info-icon { font-size: 0.9rem; color: #999; margin-left: 10px; background: #f0f0f0; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; }

        .card-subtitle { font-size: 0.9rem; color: var(--secondary-text); margin-bottom: 15px; display: flex; align-items: center; }

        /* --- TRAVEL TIME BADGE --- */
        .travel-time-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: -35px 0 15px 0;
            position: relative;
            z-index: 1;
        }
        
        .travel-time-badge {
            background-color: #EAECEE;
            color: #5D6D7E;
            font-size: 0.75rem;
            font-weight: bold;
            padding: 6px 16px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            border: 2px solid var(--bg-color);
        }
        
        .travel-line {
            position: absolute;
            top: -20px;
            bottom: 0;
            left: 50%;
            width: 2px;
            background-image: linear-gradient(to bottom, #ccc 50%, rgba(255,255,255,0) 0%);
            background-position: left;
            background-size: 2px 10px;
            background-repeat: repeat-y;
            z-index: -1;
        }

        /* --- NOTEBOOK STYLES --- */
        .form-card {
            background: white; padding: 20px; border-radius: var(--radius);
            box-shadow: var(--shadow); margin-bottom: 30px;
            border: 2px solid transparent; transition: border-color 0.3s;
        }
        .form-card.editing { border-color: var(--btn-edit); }
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; font-size: 0.8rem; font-weight: bold; margin-bottom: 5px; color: #555; }
        .form-control { width: 100%; padding: 12px; border: 1px solid #eee; border-radius: 8px; font-size: 0.95rem; background: #fafafa; }
        
        .note-list-item {
            background: white; border-radius: 10px; padding: 12px 15px; margin-bottom: 10px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.03); display: flex; align-items: center; gap: 8px;
            transition: transform 0.1s; cursor: pointer; border-bottom: 1px solid #f0f0f0;
        }
        .note-list-item:active { transform: scale(0.99); background: #f9f9f9; }
        .note-title-text { flex-grow: 1; font-size: 0.95rem; font-weight: bold; color: #333; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .note-tag-badge { font-size: 0.65rem; color: white; padding: 3px 8px; border-radius: 6px; font-weight: bold; flex-shrink: 0; }
        .note-location-text { font-size: 0.75rem; color: #999; flex-shrink: 0; display: flex; align-items: center; }
        .note-action-icon { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; flex-shrink: 0; margin-left: 2px; }
        .note-nav-icon { background: #E8F5E9; color: var(--btn-map); }
        .note-edit-icon { background: #EBF5FB; color: var(--btn-edit); }
        .note-delete-icon { background: #FDEDEC; color: var(--tag-todo); }

        /* --- RECOMMENDATION & CVS --- */
        .recommendation-box { margin-top: 15px; background: #FFF9F0; border-radius: 12px; padding: 12px; display: flex; gap: 12px; align-items: center; }
        .rec-img { width: 60px; height: 60px; border-radius: 8px; object-fit: cover; flex-shrink: 0; }
        .rec-text h4 { margin: 0 0 4px 0; font-size: 0.9rem; color: #D35400; }
        .rec-text p { margin: 0; font-size: 0.8rem; color: #666; line-height: 1.4; }
        
        .shop-list { margin-top: 10px; }
        .shop-item { display: flex; align-items: center; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px dashed #eee; }
        .shop-item:last-child { border-bottom: none; margin-bottom: 0; }
        .shop-thumb { width: 50px; height: 50px; border-radius: 8px; object-fit: cover; margin-right: 12px; background: #f0f0f0; }
        .shop-info { flex: 1; }
        .shop-name { font-size: 0.9rem; font-weight: bold; color: #333; }
        .shop-desc { font-size: 0.75rem; color: #666; margin-top: 2px; }
        .shop-nav { color: var(--btn-map); font-size: 1.2rem; padding: 5px; }

        .cvs-box { margin-top: 20px; background: #F4F6F7; border-radius: 12px; padding: 15px; border-left: 4px solid var(--btn-map); }
        .cvs-title { font-size: 0.85rem; font-weight: bold; color: var(--primary-text); margin-bottom: 10px; display: flex; align-items: center; }
        .cvs-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px dashed #ddd; }
        .cvs-item:last-child { margin-bottom: 0; padding-bottom: 0; border-bottom: none; }
        .cvs-info div { font-size: 0.9rem; font-weight: bold; }
        .cvs-info span { font-size: 0.75rem; color: #666; }
        .cvs-btn { background: white; border: 1px solid var(--btn-map); color: var(--btn-map); padding: 5px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: bold; text-decoration: none; display: flex; align-items: center; }
        .cvs-btn i { margin-right: 5px; }

        /* --- HIGHLIGHTS --- */
        .highlight-box { margin-top: 15px; padding-top: 15px; border-top: 1px solid #f0f0f0; }
        .highlight-text { font-size: 0.9rem; line-height: 1.6; color: #444; text-align: justify; }

        /* --- BUTTONS --- */
        .action-buttons { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
        .btn { width: 100%; padding: 12px; border-radius: 8px; text-align: center; text-decoration: none; font-size: 0.9rem; font-weight: 500; display: flex; align-items: center; justify-content: center; transition: 0.2s; border:none; cursor:pointer;}
        .btn i { margin-right: 8px; }
        .btn-map { background-color: var(--btn-map); color: white; box-shadow: 0 4px 10px rgba(66, 128, 69, 0.2); }
        .btn-cancel { background-color: #95A5A6; color: white; display: none; margin-top: 10px; }

        /* --- MODAL --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; display: none; justify-content: center; align-items: flex-end; }
        .modal-overlay.active { display: flex; animation: fadeIn 0.3s; }
        .modal-content { background: white; width: 100%; max-width: 600px; border-radius: 20px 20px 0 0; padding: 30px 25px; max-height: 85vh; overflow-y: auto; position: relative; animation: slideUp 0.3s; }
        .modal-close-btn { position: absolute; top: 20px; right: 20px; background: #f0f0f0; border: none; width: 30px; height: 30px; border-radius: 50%; font-size: 1.2rem; color: #666; cursor: pointer; }
        .modal-title { font-family: 'Noto Serif JP', serif; font-size: 1.5rem; margin-bottom: 15px; padding-right: 30px; }
        .modal-body { font-size: 1rem; line-height: 1.8; color: #333; }
        .modal-body p { margin-bottom: 15px; }
        .modal-subtitle { font-weight:bold; color:var(--btn-map); margin-top:20px; margin-bottom:10px; font-size:1.1rem; display:flex; align-items:center; }
        .modal-subtitle i { margin-right:8px; }

        /* --- MAINTENANCE MODE --- */
        .maintenance-container { text-align: center; padding-top: 100px; padding-bottom: 40px; color: #95A5A6; }
        .maintenance-icon-wrapper { position: relative; display: inline-block; margin-bottom: 20px; }
        .maintenance-main-icon { font-size: 5rem; color: #BDC3C7; }
        .maintenance-sub-icon { font-size: 2.5rem; position: absolute; bottom: -10px; right: -10px; color: #F39C12; background: #fff; border-radius: 50%; padding: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        /* --- USAGI GIF ANIMATION --- */
        .usagi-patrol { position: fixed; bottom: 80px; left: -100px; width: 80px; z-index: 9999; pointer-events: none; animation: usagiRun 15s linear infinite; }
        .usagi-patrol img { width: 100%; height: auto; display: block; }
        @keyframes usagiRun { 0% { left: -100px; transform: scaleX(-1); } 45% { left: 100%; transform: scaleX(-1); } 50% { left: 100%; transform: scaleX(1); } 95% { left: -100px; transform: scaleX(1); } 100% { left: -100px; transform: scaleX(-1); } }

        /* --- BOTTOM NAV --- */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); display: flex; justify-content: space-around; padding: 15px 0 25px 0; border-top: 1px solid rgba(0,0,0,0.05); z-index: 999; }
        .nav-item { text-align: center; color: #ccc; cursor: pointer; flex: 1; }
        .nav-item.active { color: var(--primary-text); }
        .nav-item i { font-size: 1.2rem; margin-bottom: 4px; display: block; }
        .nav-item span { font-size: 0.65rem; font-weight: 500; letter-spacing: 0.05em; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="usagi-patrol">
        <img src="https://picx.zhimg.com/v2-a5881db720f3e30474da551e4e84ad59_b.webp" alt="Usagi Running">
    </div>

    <header>
        <div class="trip-title">TOKYO TRIP 2025</div>
        <h2 style="text-align:center; margin:0 0 15px 0; font-size:1.2rem; font-weight:bold;">烏拉呀哈東京迷路大作戰</h2>
        
        <div id="date-nav-container" class="date-scroller">
            <div class="date-item active" onclick="switchDay('day1', this)"><span class="day-name">WED</span><span class="day-num">10</span></div>
            <div class="date-item" onclick="switchDay('day2', this)"><span class="day-name">THU</span><span class="day-num">11</span></div>
            <div class="date-item" onclick="switchDay('day3', this)"><span class="day-name">FRI</span><span class="day-num">12</span></div>
            <div class="date-item" onclick="switchDay('day4', this)"><span class="day-name">SAT</span><span class="day-num">13</span></div>
            <div class="date-item" onclick="switchDay('day5', this)"><span class="day-name">SUN</span><span class="day-num">14</span></div>
        </div>
    </header>

    <div id="tab-itinerary" class="tab-content active container">
        <div id="day1" class="day-view active">
            <div class="weather-scroll-container"><div class="weather-title">東京/箱根・今日預報</div><div class="weather-scroll"><div class="weather-hour"><span>09:00</span><i class="fas fa-cloud-sun"></i><span>15°</span></div><div class="weather-hour"><span>12:00</span><i class="fas fa-sun"></i><span>17°</span></div><div class="weather-hour"><span>15:00</span><i class="fas fa-sun"></i><span>16°</span></div></div></div>
            <div class="meal-card"><i class="fas fa-coffee"></i> <strong>早餐：</strong> 溫暖的家</div>
            <div class="timeline-card"><img src="https://s.yimg.com/ny/api/res/1.2/erw10hmX9ybLRm4lB7pP.A--/YXBwaWQ9aGlnaGxhbmRlcjt3PTk2MDtoPTU0MTtjZj13ZWJw/https://media.zenfs.com/ko/taisounds_com_380/25ef305fcce02ba63c43f73dae765b52" class="card-image"><div class="card-content"><div class="card-meta"><i class="fas fa-plane"></i> FLIGHT 09:30</div><h3 class="card-title">桃園 -> 東京成田</h3><div class="highlight-box"><div class="highlight-text">06:30 於桃園機場第二航廈華航櫃台集合。</div></div></div></div>
            <div class="meal-card"><i class="fas fa-utensils"></i> <strong>午餐：</strong> 機上套餐</div>
            <div class="timeline-card"><img src="https://ak-d.tripcdn.com/images/100w060000001rrhtEE7E_R_750_520.jpg_.webp?_fr=wc" class="card-image"><div class="card-content"><div class="card-meta"><i class="fas fa-shopping-bag"></i> SHOPPING</div><h3 class="card-title">箱根湯本商店街散策</h3><div class="card-subtitle">抵達箱根後的第一站</div><div class="shop-list"><div class="shop-item"><img src="https://images.unsplash.com/photo-1601205741712-b261aff33a7d?auto=format&fit=crop&w=200&q=80" class="shop-thumb"><div class="shop-info"><div class="shop-name">菊川商店</div><div class="shop-desc">長崎蛋糕饅頭</div></div><a href="https://www.google.com/maps/search/?api=1&query=Kikukawa+Shoten+Hakone" target="_blank" class="shop-nav"><i class="fas fa-location-arrow"></i></a></div><div class="shop-item"><img src="https://images.unsplash.com/photo-1558961363-fa8fdf82db35?auto=format&fit=crop&w=200&q=80" class="shop-thumb"><div class="shop-info"><div class="shop-name">手燒堂 (愛心仙貝)</div><div class="shop-desc">炭火現烤的醬油仙貝</div></div><a href="https://www.google.com/maps/search/?api=1&query=Teyakido+Hakone" target="_blank" class="shop-nav"><i class="fas fa-location-arrow"></i></a></div><div class="shop-item"><img src="https://muzi.com.tw/wp-content/uploads/2024/05/%E7%AE%B1%E6%A0%B9%E4%BC%B4%E6%89%8B%E7%A6%AE5.jpg" class="shop-thumb"><div class="shop-info"><div class="shop-name">箱根 Rusk</div><div class="shop-desc">推薦焦糖杏仁口味</div></div><a href="https://www.google.com/maps/search/?api=1&query=Grande+Riviere+Hakone+Yumoto" target="_blank" class="shop-nav"><i class="fas fa-location-arrow"></i></a></div><div class="shop-item"><img src="https://muzi.com.tw/wp-content/uploads/2024/05/%E7%AE%B1%E6%A0%B9%E4%BC%B4%E6%89%8B%E7%A6%AE1.jpg" class="shop-thumb"><div class="shop-info"><div class="shop-name">湯麻糬</div><div class="shop-desc">軟嫩柚子香</div></div><a href="https://www.google.com/maps/search/?api=1&query=Chimoto+Hakone" target="_blank" class="shop-nav"><i class="fas fa-location-arrow"></i></a></div></div></div></div>
            <div class="timeline-card"><img src="https://www.timesclub.jp/sp/tanomachi_ex/kanagawa/hakone/images/009_ph002.jpg" class="card-image"><div class="card-content"><div class="card-meta"><i class="fas fa-bed"></i> HOTEL</div><h3 class="card-title" onclick="showDetail('tenseien')">箱根天成園 <div class="info-icon"><i class="fas fa-info"></i></div></h3><div class="card-subtitle">Hakone Tenseien</div><div class="recommendation-box"><img src="https://muzi.com.tw/wp-content/uploads/2024/05/%E7%AE%B1%E6%A0%B9%E4%BC%B4%E6%89%8B%E7%A6%AE3.jpg" class="rec-img"><div class="rec-text"><h4>順路必吃：箱根饅頭</h4><p>箱根湯本車站前的商店街有現蒸的溫泉饅頭。</p></div></div><div class="cvs-box"><div class="cvs-title"><i class="fas fa-store" style="margin-right:6px; color:#F39C12;"></i> 附近便利商店 (補給站)</div><div class="cvs-item"><div class="cvs-info"><div>Lawson 箱根湯本店</div><span style="color:#C0392B;">營業時間：07:00 - 22:00 (非24h)</span></div><a href="https://www.google.com/maps/search/?api=1&query=Lawson+Hakone+Yumoto" target="_blank" class="cvs-btn"><i class="fas fa-location-arrow"></i> 導航</a></div><div class="cvs-item"><div class="cvs-info"><div>7-Eleven 箱根湯本駅前店</div><span style="color:#27AE60;">營業時間：24小時</span></div><a href="https://www.google.com/maps/search/?api=1&query=7-Eleven+Hakone+Yumoto+Station" target="_blank" class="cvs-btn"><i class="fas fa-location-arrow"></i> 導航</a></div></div><div class="action-buttons"><a href="https://maps.google.com/?q=箱根天成園" target="_blank" class="btn btn-map"><i class="fas fa-location-arrow"></i> 導航至飯店</a></div></div></div>
            <div class="meal-card"><i class="fas fa-utensils"></i> <strong>晚餐：</strong> 會席料理 - 晚宴</div>
        </div>
        <div id="day2" class="day-view">
             <div class="weather-scroll-container"><div class="weather-title">箱根・預測天氣</div><div class="weather-scroll"><div class="weather-hour"><span>09:00</span><i class="fas fa-cloud"></i><span>8°</span></div><div class="weather-hour"><span>12:00</span><i class="fas fa-cloud-sun"></i><span>12°</span></div></div></div>
             <div class="meal-card"><i class="fas fa-coffee"></i> <strong>早餐：</strong> 飯店內享用</div>
             <div class="timeline-card"><img src="https://www.travelliker.com.hk/img/upload/img/3-81.png" class="card-image"><div class="card-content"><div class="card-meta"><i class="fas fa-mountain"></i> ACTIVITY</div><h3 class="card-title" onclick="showDetail('ropeway')">大湧谷纜車體驗 <div class="info-icon"><i class="fas fa-info"></i></div></h3></div></div>
             <div class="timeline-card"><img src="https://www.travelliker.com.hk/img/upload/img/4-64.png" class="card-image"><div class="card-content"><div class="card-meta"><i class="fas fa-utensils"></i> MUST EAT</div><h3 class="card-title" onclick="showDetail('owakudani')">大湧谷 (黑蛋) <div class="info-icon"><i class="fas fa-info"></i></div></h3></div></div>
             <div class="meal-card"><i class="fas fa-utensils"></i> <strong>午餐：</strong> 箱根風味餐</div>
             <div class="timeline-card"><img src="https://www.travelliker.com.hk/img/upload/img/1-942.jpg" class="card-image"><div class="card-content"><div class="card-meta"><i class="fas fa-ship"></i> CRUISE</div><h3 class="card-title" onclick="showDetail('ashinoko')">蘆之湖海賊船 <div class="info-icon"><i class="fas fa-info"></i></div></h3><div class="action-buttons"><a href="https://maps.google.com/?q=箱根海賊船" target="_blank" class="btn btn-map"><i class="fas fa-location-arrow"></i> 導航</a></div></div></div>
             <div class="timeline-card"><img src="https://s3-ap-northeast-1.amazonaws.com/thegate/2021/04/14/12/41/19/Hakone%20shrine.jpg" class="card-image"><div class="card-content"><div class="card-meta"><i class="fas fa-torii-gate"></i> CULTURE</div><h3 class="card-title" onclick="showDetail('hakone_shrine')">箱根神社 <div class="info-icon"><i class="fas fa-info"></i></div></h3></div></div>
             <div class="meal-card"><i class="fas fa-utensils"></i> <strong>晚餐：</strong> 自助式百匯料理</div>
             <div class="timeline-card"><img src="https://www.timesclub.jp/sp/tanomachi_ex/kanagawa/hakone/images/009_ph002.jpg" class="card-image"><div class="card-content"><div class="card-meta"><i class="fas fa-bed"></i> HOTEL (續住)</div><h3 class="card-title" onclick="showDetail('tenseien')">箱根天成園 <div class="info-icon"><i class="fas fa-info"></i></div></h3><div class="cvs-box"><div class="cvs-title"><i class="fas fa-store" style="margin-right:6px; color:#F39C12;"></i> 附近便利商店 (補給站)</div><div class="cvs-item"><div class="cvs-info"><div>Lawson 箱根湯本店</div><span style="color:#C0392B;">營業時間：07:00 - 22:00 (非24h)</span></div><a href="https://www.google.com/maps/search/?api=1&query=Lawson+Hakone+Yumoto" target="_blank" class="cvs-btn"><i class="fas fa-location-arrow"></i> 導航</a></div><div class="cvs-item"><div class="cvs-info"><div>7-Eleven 箱根湯本駅前店</div><span style="color:#27AE60;">營業時間：24小時</span></div><a href="https://www.google.com/maps/search/?api=1&query=7-Eleven+Hakone+Yumoto+Station" target="_blank" class="cvs-btn"><i class="fas fa-location-arrow"></i> 導航</a></div></div></div></div>
        </div>
        <div id="day3" class="day-view">
            <div class="timeline-card"><div class="card-content"><div class="card-meta"><i class="fas fa-map-marker-alt"></i> START</div><h3 class="card-title">出發：箱根天成園</h3></div></div>
            <div class="meal-card"><i class="fas fa-coffee"></i> <strong>早餐：</strong> 飯店內享用</div>
            <div class="travel-time-container"><div class="travel-line"></div><div class="travel-time-badge"><i class="fas fa-car-side"></i> 預估車程：1小時20分</div></div>
            <div class="timeline-card"><img src="https://images.unsplash.com/photo-1579758782390-3490b4d4554f?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" class="card-image"><div class="card-content"><h3 class="card-title" onclick="showDetail('saiko')">西湖里根場 <div class="info-icon"><i class="fas fa-info"></i></div></h3><div class="action-buttons"><a href="https://maps.google.com/?q=西湖いやしの里根場" target="_blank" class="btn btn-map"><i class="fas fa-location-arrow"></i> 導航</a></div></div></div>
            <div class="travel-time-container"><div class="travel-line"></div><div class="travel-time-badge"><i class="fas fa-car-side"></i> 預估車程：30分</div></div>
            <div class="meal-card"><i class="fas fa-utensils"></i> <strong>午餐：</strong> 河口湖特色料理</div>
            <div class="timeline-card"><img src="https://images.unsplash.com/photo-1552611052-33e04de081de?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" class="card-image"><div class="card-content"><h3 class="card-title" onclick="showDetail('appare')">河口湖天晴號 <div class="info-icon"><i class="fas fa-info"></i></div></h3><div class="action-buttons"><a href="https://www.google.com/maps/search/?api=1&query=Kawaguchiko+Appare+Boat" target="_blank" class="btn btn-map"><i class="fas fa-location-arrow"></i> 導航</a></div></div></div>
            <div class="travel-time-container"><div class="travel-line"></div><div class="travel-time-badge"><i class="fas fa-car-side"></i> 預估車程：20分</div></div>
            <div class="timeline-card"><img src="https://images.unsplash.com/photo-1526481280693-3bfa7568e0f3?auto=format&fit=crop&w=800&q=80" class="card-image"><div class="card-content"><h3 class="card-title" onclick="showDetail('chureito')">新倉山淺間公園 <div class="info-icon"><i class="fas fa-info"></i></div></h3><div class="action-buttons"><a href="https://maps.google.com/?q=新倉山淺間公園" target="_blank" class="btn btn-map"><i class="fas fa-location-arrow"></i> 導航</a></div></div></div>
            <div class="travel-time-container"><div class="travel-line"></div><div class="travel-time-badge"><i class="fas fa-car-side"></i> 預估車程：1小時40分</div></div>
            <div class="timeline-card"><div class="card-content"><div class="card-meta"><i class="fas fa-bed"></i> HOTEL</div><h3 class="card-title">太陽城王子大飯店</h3><div class="action-buttons"><a href="https://maps.google.com/?q=太陽城王子大飯店" target="_blank" class="btn btn-map"><i class="fas fa-location-arrow"></i> 導航至飯店</a></div></div></div>
            <div class="meal-card"><i class="fas fa-utensils"></i> <strong>晚餐：</strong> 方便逛街自理</div>
        </div>
        <div id="day4" class="day-view">
            <div class="meal-card"><i class="fas fa-coffee"></i> <strong>早餐：</strong> 飯店內享用</div>
            <div class="meal-card"><i class="fas fa-utensils"></i> <strong>午/晚餐：</strong> 方便逛街自理</div>
            <div class="timeline-card"><img src="https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?auto=format&fit=crop&w=800&q=80" class="card-image"><div class="card-content"><div class="card-meta"><i class="fas fa-walking"></i> FREE TIME</div><h3 class="card-title">全日自由活動</h3><div class="action-buttons"><a href="https://maps.google.com/?q=東京" target="_blank" class="btn btn-map"><i class="fas fa-map"></i> 開啟 Google Maps 探索</a></div></div></div>
        </div>
        <div id="day5" class="day-view">
            <div class="meal-card"><i class="fas fa-coffee"></i> <strong>早餐：</strong> 飯店內享用</div>
            <div class="timeline-card"><img src="https://images.unsplash.com/photo-1570710891163-6d3b5c47248b?auto=format&fit=crop&w=800&q=80" class="card-image"><div class="card-content"><div class="card-meta"><i class="fas fa-plane"></i> FLIGHT 14:35</div><h3 class="card-title">成田機場 -> 桃園</h3></div></div>
            <div class="meal-card"><i class="fas fa-utensils"></i> <strong>晚餐：</strong> 溫暖的家</div>
        </div>
        <div style="height:40px;"></div>
    </div>

    <div id="tab-notebook" class="tab-content container">
        <div style="margin:20px 0;">
            <div class="form-card" id="note-form-card">
                <h3 style="margin:0 0 15px 0;" id="form-title">新增景點筆記</h3>
                <div class="form-group"><label class="form-label">標題</label><input type="text" id="note-title" class="form-control" placeholder="例如：想吃的拉麵..."></div>
                <div style="display:flex; gap:10px;">
                    <div class="form-group" style="flex:1;"><label class="form-label">地點</label><select id="note-location" class="form-control"><option value="東京">東京</option><option value="池袋">池袋</option><option value="箱根">箱根</option><option value="河口湖">河口湖</option><option value="機場">機場</option><option value="其他">其他</option></select></div>
                    <div class="form-group" style="flex:1;"><label class="form-label">分類</label><select id="note-category" class="form-control"><option value="eat">吃 (Food)</option><option value="buy">買 (Buy)</option><option value="spot">景點 (Spot)</option><option value="todo">待辦 (To-do)</option><option value="other">其他 (Other)</option></select></div>
                </div>
                <div class="form-group"><label class="form-label">地圖連結 (選填)</label><input type="url" id="note-map" class="form-control" placeholder="https://goo.gl/maps/..."></div>
                <div class="form-group"><label class="form-label">詳細說明</label><textarea id="note-desc" class="form-control" rows="3" placeholder="備註..."></textarea></div>
                <div class="form-group"><label class="form-label">圖片上傳</label><input type="file" id="note-image" class="form-control" accept="image/*"></div>
                <button onclick="handleAddOrUpdate()" id="btn-submit" class="btn btn-map" style="width:100%; background:var(--primary-text);"><i class="fas fa-plus"></i> 加入筆記</button>
                <button onclick="resetForm()" id="btn-cancel" class="btn btn-cancel" style="width:100%;">取消編輯</button>
            </div>
            <div id="empty-msg" style="text-align:center; color:#999; margin-top:30px;">還沒有筆記，快來新增吧！</div>
            <div id="notes-list"></div>
        </div>
    </div>

    <div id="tab-budget" class="tab-content container">
        <div class="maintenance-container"><div class="maintenance-icon-wrapper"><i class="fas fa-tools maintenance-main-icon"></i><i class="fas fa-hard-hat maintenance-sub-icon"></i></div><h3 style="margin:15px 0; color:#2C3E50;">記帳功能維修中</h3><p style="font-size:0.95rem;">工程師正在努力中！</p></div>
    </div>

    <div id="tab-info" class="tab-content container">
        <h2 class="serif-font" style="margin:20px 0 15px 0;">航班資訊</h2>
        <div class="timeline-card"><div class="card-content"><div style="display:flex; justify-content:space-between;"><div style="font-weight:bold;">CI100 09:30 桃園</div><div>CI101 14:35 成田</div></div></div></div>
        <div class="timeline-card" style="text-align:center;"><div class="card-content"><div style="font-size:2rem; font-weight:bold; color:#C0392B;">119</div><div>救護 / 火警</div></div></div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('itinerary', this)"><i class="far fa-map"></i><span>行程</span></div>
        <div class="nav-item" onclick="switchTab('notebook', this)"><i class="far fa-sticky-note"></i><span>記事</span></div>
        <div class="nav-item" onclick="switchTab('budget', this)"><i class="far fa-credit-card"></i><span>記帳</span></div>
        <div class="nav-item" onclick="switchTab('info', this)"><i class="far fa-user"></i><span>資訊</span></div>
    </nav>

    <div id="detail-modal" class="modal-overlay" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="modal-close-btn" onclick="closeModal(event)">×</button>
            <div id="modal-tag-container" style="display:inline-block; background:var(--accent-gold); color:white; padding:4px 10px; border-radius:4px; font-size:0.8rem; margin-bottom:15px;">景點介紹</div>
            <h2 class="modal-title" id="modal-title">標題</h2>
            <div class="modal-body" id="modal-body"></div>
        </div>
    </div>

    <script>
        // --- NOTEBOOK INSTANT UPDATE & FIX ---
        let notes = [];
        let editingNoteId = null;

        function loadNotes() {
            const savedNotes = localStorage.getItem('trip_notes_v3');
            if (savedNotes) {
                notes = JSON.parse(savedNotes);
                renderNotesList();
            }
        }

        function saveNotes() {
            try {
                localStorage.setItem('trip_notes_v3', JSON.stringify(notes));
            } catch (e) {
                alert('儲存空間不足，請刪除部分照片！');
            }
        }

        function resizeImage(file, maxWidth, maxHeight, callback) {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function (event) {
                const img = new Image();
                img.src = event.target.result;
                img.onload = function () {
                    let width = img.width; let height = img.height;
                    if (width > height) { if (width > maxWidth) { height *= maxWidth / width; width = maxWidth; } } 
                    else { if (height > maxHeight) { width *= maxHeight / height; height = maxHeight; } }
                    const canvas = document.createElement('canvas');
                    canvas.width = width; canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    callback(canvas.toDataURL('image/jpeg', 0.5));
                };
            };
        }

        function handleAddOrUpdate() {
            const title = document.getElementById('note-title').value;
            const location = document.getElementById('note-location').value;
            const category = document.getElementById('note-category').value;
            const mapLink = document.getElementById('note-map').value;
            const desc = document.getElementById('note-desc').value;
            const imageInput = document.getElementById('note-image');

            if (!title) { alert('請輸入標題'); return; }

            const updateUI = (imgData) => {
                if (editingNoteId) {
                    const index = notes.findIndex(n => n.id === editingNoteId);
                    if (index !== -1) {
                        notes[index] = { ...notes[index], title, location, category, mapLink, desc };
                        if (imgData) notes[index].imgData = imgData;
                    }
                } else {
                    const note = { id: Date.now(), title, location, category, mapLink, desc, imgData };
                    notes.unshift(note);
                }
                saveNotes();
                renderNotesList();
                resetForm();
            };

            if (imageInput.files && imageInput.files[0]) {
                resizeImage(imageInput.files[0], 600, 600, updateUI);
            } else {
                updateUI(null);
            }
        }

        function renderNotesList() {
            const listEl = document.getElementById('notes-list');
            const emptyMsg = document.getElementById('empty-msg');
            
            listEl.innerHTML = ''; 
            if(notes.length === 0) { 
                emptyMsg.style.display = 'block'; 
            } else {
                emptyMsg.style.display = 'none';
            }

            notes.forEach(note => {
                let tagColor = '#95A5A6'; let tagText = '其他';
                if(note.category === 'eat') { tagColor = 'var(--tag-eat)'; tagText = '吃'; }
                if(note.category === 'buy') { tagColor = 'var(--tag-buy)'; tagText = '買'; }
                if(note.category === 'spot') { tagColor = 'var(--tag-spot)'; tagText = '景點'; }
                if(note.category === 'todo') { tagColor = 'var(--tag-todo)'; tagText = '待辦'; }

                const item = document.createElement('div');
                item.className = 'note-list-item';
                item.onclick = (e) => {
                    if(e.target.closest('.note-nav-icon') || e.target.closest('.note-edit-icon') || e.target.closest('.note-delete-icon')) return;
                    showUserNoteDetail(note);
                };

                let navBtnHTML = note.mapLink 
                    ? `<a href="${note.mapLink}" target="_blank" class="note-action-icon note-nav-icon"><i class="fas fa-location-arrow"></i></a>`
                    : ``;

                item.innerHTML = `
                    <span class="note-title-text">${note.title}</span>
                    <span class="note-tag-badge" style="background:${tagColor}">${tagText}</span>
                    <span class="note-location-text"><i class="fas fa-map-marker-alt"></i> ${note.location}</span>
                    ${navBtnHTML}
                    <div class="note-action-icon note-edit-icon" onclick="editNote(${note.id})"><i class="fas fa-pen"></i></div>
                    <div class="note-action-icon note-delete-icon" onclick="deleteNote(${note.id})"><i class="fas fa-trash-alt"></i></div>
                `;
                listEl.appendChild(item);
            });
        }

        function editNote(id) {
            const note = notes.find(n => n.id === id);
            if (!note) return;
            editingNoteId = id;
            document.getElementById('note-title').value = note.title;
            document.getElementById('note-location').value = note.location;
            document.getElementById('note-category').value = note.category;
            document.getElementById('note-map').value = note.mapLink || '';
            document.getElementById('note-desc').value = note.desc || '';
            document.getElementById('form-title').innerText = '編輯筆記';
            document.getElementById('btn-submit').innerHTML = '<i class="fas fa-save"></i> 更新筆記';
            document.getElementById('btn-submit').style.background = 'var(--btn-edit)';
            document.getElementById('btn-cancel').style.display = 'block';
            document.getElementById('note-form-card').classList.add('editing');
            document.getElementById('tab-notebook').scrollIntoView({behavior: 'smooth'});
        }

        function resetForm() {
            editingNoteId = null;
            document.getElementById('note-title').value = '';
            document.getElementById('note-desc').value = '';
            document.getElementById('note-map').value = '';
            document.getElementById('note-image').value = '';
            document.getElementById('form-title').innerText = '新增景點筆記';
            document.getElementById('btn-submit').innerHTML = '<i class="fas fa-plus"></i> 加入筆記';
            document.getElementById('btn-submit').style.background = 'var(--primary-text)';
            document.getElementById('btn-cancel').style.display = 'none';
            document.getElementById('note-form-card').classList.remove('editing');
        }

        function deleteNote(id) {
            if(confirm('確定刪除？')) {
                notes = notes.filter(n => n.id !== id);
                saveNotes();
                renderNotesList();
            }
        }

        function showUserNoteDetail(note) {
            document.getElementById('modal-title').innerText = note.title;
            let content = '';
            if(note.imgData) content += `<img src="${note.imgData}" style="width:100%; border-radius:12px; margin-bottom:15px;">`;
            content += note.desc ? `<p style="white-space:pre-wrap;">${note.desc}</p>` : `<p style="color:#999;">沒有詳細說明</p>`;
            document.getElementById('modal-body').innerHTML = content;
            document.getElementById('modal-tag-container').style.display = 'none';
            document.getElementById('detail-modal').classList.add('active');
        }

        // Load notes on startup
        loadNotes();

        // --- EXISTING UTILS ---
        function switchDay(dayId, btnElement) {
            var allDays = document.querySelectorAll('.day-view');
            for (var i = 0; i < allDays.length; i++) { allDays[i].classList.remove('active'); }
            document.getElementById(dayId).classList.add('active');
            var allBtns = document.querySelectorAll('.date-item');
            for (var j = 0; j < allBtns.length; j++) { allBtns[j].classList.remove('active'); }
            if(btnElement) { btnElement.classList.add('active'); btnElement.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' }); }
        }

        function switchTab(tabId, navElement) {
            var allTabs = document.querySelectorAll('.tab-content');
            for (var i = 0; i < allTabs.length; i++) { allTabs[i].classList.remove('active'); }
            document.getElementById('tab-' + tabId).classList.add('active');
            var allNavs = document.querySelectorAll('.nav-item');
            for (var j = 0; j < allNavs.length; j++) { allNavs[j].classList.remove('active'); }
            navElement.classList.add('active');
            window.scrollTo(0, 0);
            if(tabId === 'itinerary') document.getElementById('date-nav-container').style.display = 'flex';
            else document.getElementById('date-nav-container').style.display = 'none';
        }

        const attractionDetails = {
            'tenseien': { title: '箱根天成園', content: '<p><strong>必體驗：</strong>天空大露天風呂...</p>' },
            'ropeway': { title: '大湧谷纜車', content: '<p>空中散步眺望富士山...</p>' },
            'owakudani': { title: '大湧谷 (黑蛋)', content: '<p>必吃：長壽黑蛋、黑色咖哩麵包...</p>' },
            'ashinoko': { title: '蘆之湖海賊船', content: '<p>必吃：Bakery & Table 米粉咖哩麵包...</p>' },
            'hakone_shrine': { title: '箱根神社', content: '<p>必買：勝守、權現力餅...</p>' },
            'saiko': { title: '西湖里根場', content: '<p>必吃：爐端燒糰子...</p>' },
            'appare': { title: '河口湖天晴號', content: '<p>必買：富士山造型餅乾...</p>' },
            'chureito': { title: '新倉山淺間公園', content: '<p>必吃：吉田烏龍麵...</p>' }
        };

        function showDetail(key) {
            const data = attractionDetails[key];
            if(data) {
                document.getElementById('modal-title').innerText = data.title;
                document.getElementById('modal-body').innerHTML = data.content;
                document.getElementById('modal-tag-container').style.display = 'inline-block';
                document.getElementById('detail-modal').classList.add('active');
            }
        }

        function closeModal(event) {
            if (event) event.preventDefault();
            document.getElementById('detail-modal').classList.remove('active');
        }
    </script>
</body>
</html>
